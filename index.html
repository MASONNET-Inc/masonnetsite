<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MASONNET Web 3.0</title>
  <style>
    :root{
      --bg:#ff0000;
      --glass: rgba(255,255,255,0.10);
      --glass-strong: rgba(255,255,255,0.26);
      --accent:#ffffff;
      --muted: rgba(255,255,255,0.85);
      --shadow: 0 6px 18px rgba(0,0,0,0.15);
      --max-content:1100px;
      --safe-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px);
      --island-max:760px;
      --view-threshold-ms: 3600000; /* 1 hour */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,var(--bg),var(--bg));
      color:var(--accent);
      -webkit-font-smoothing:antialiased;
      line-height:1.35;
      display:flex;
      justify-content:center;
    }

    .page{
      width:100%;
      max-width:var(--max-content);
      padding: clamp(16px, 3.5vw, 36px);
      padding-bottom: calc(var(--safe-bottom) + 150px);
    }

    .site-header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      flex-direction:column;
    }

    .logo{
      width:clamp(160px, 28vw, 420px);
      height:auto;
      display:block;
      border-radius:8px;
      object-fit:contain;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,0.25));
    }

    /* Heading less bold and less heavy */
    h1{
      margin:10px 0 0;
      font-size: clamp(20px, 4.2vw, 36px);
      font-weight:500; /* reduced weight */
      text-align:center;
      background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    h1 u{ text-decoration: underline; text-decoration-thickness:2px; text-decoration-color: rgba(255,255,255,0.35); }

    .main{
      max-width:980px;
      margin:0 auto;
      text-align:center;
      font-size:clamp(14px, 2.6vw, 18px);
    }

    .button-island {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: var(--safe-bottom);
      z-index: 1100;
      display:flex;
      gap:12px;
      padding: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      backdrop-filter: blur(10px) saturate(1.05);
      -webkit-backdrop-filter: blur(10px) saturate(1.05);
      border-radius: 999px;
      box-shadow: var(--shadow);
      width: min(calc(100% - 32px), var(--island-max));
      justify-content: space-between;
      align-items:center;
      transition: transform 160ms ease;
    }

    .button-island button{
      all:unset;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: clamp(12px, 2.8vw, 18px) clamp(12px, 3.8vw, 26px);
      background: var(--glass);
      color:var(--accent);
      font-weight:700;
      font-size: clamp(14px, 2.6vw, 18px);
      border-radius:999px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.02);
      transition: transform 140ms ease, background 140ms ease, box-shadow 140ms ease;
      flex:1;
      text-align:center;
      min-width: 64px;
    }

    .button-island button:hover,
    .button-island button:focus{
      transform: translateY(-4px);
      background: var(--glass-strong);
      outline: none;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
    }

    .button-island .info-btn{
      flex:0 0 auto;
      width:48px;
      height:48px;
      padding:0;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }

    .button-island .info-btn svg{width:20px;height:20px;opacity:0.98}

    /* Info panel: right side, smaller width, taller feel */
    .info-panel{
      position: fixed;
      right: 16px;               /* pinned to right */
      bottom: calc(var(--safe-bottom) + 80px);
      z-index: 1150;
      width: clamp(200px, 28vw, 320px); /* narrower */
      max-width: 92%;
      min-width: 180px;
      max-height: calc(60vh);
      min-height: 120px;
      box-sizing: border-box;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      background: linear-gradient(180deg, rgba(30,30,30,0.96), rgba(20,20,20,0.96));
      color:#fff;
      padding:12px;
      border-radius:12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
      display:none;
      gap:8px;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-size:14px;
      word-break:break-word;
      white-space:normal;
    }

    .info-panel.visible{
      display:flex;
      flex-direction:column;
      transform: translateY(0);
    }

    .info-panel .row{
      width:100%;
      display:flex;
      justify-content:center;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }

    .info-panel .version-tag{ font-weight:700; background:rgba(255,255,255,0.04); padding:6px 10px; border-radius:999px; font-size:13px; }
    .info-panel .authors{ opacity:0.92; font-weight:500; font-size:13px; }
    .info-panel .contact-link{ display:inline-block; margin-top:8px; color:#fff; text-decoration:underline; font-weight:600; font-size:13px; }

    /* embedded view badge inside the panel */
    .panel-view {
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      padding:6px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:999px;
      font-weight:700;
      font-size:13px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.16);
      min-width:100px;
    }

    .panel-view .eye { width:16px;height:16px; display:inline-block; opacity:0.95; }

    @media (max-width:520px){
      .button-island{ gap:8px; padding:10px; width: calc(100% - 24px) }
      .button-island .info-btn{ width:44px; height:44px }
      .info-panel{ right: 12px; bottom: calc(var(--safe-bottom) + 72px); width: min(86vw, 300px); max-height: 65vh; }
    }

    @media (hover:none){
      .button-island button:hover{ transform:none; box-shadow: 0 6px 18px rgba(0,0,0,0.12) }
    }

    /* scrollbar aesthetics for info panel */
    .info-panel::-webkit-scrollbar{ height:8px; width:8px }
    .info-panel::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.06); border-radius:8px }
  </style>
</head>
<body>
  <div class="page" id="page">
    <header class="site-header" role="banner">
      <img src="logo.png" alt="MASONNET logo" class="logo" />
      <h1>Welcome to MASONNET Web <u>3.0</u>!</h1>
    </header>

    <main class="main" role="main">
      <!-- intentionally left empty below the heading as requested -->
    </main>
  </div>

  <!-- Info panel now on the right and smaller -->
  <div class="info-panel" id="infoPanel" role="dialog" aria-hidden="true" aria-live="polite" tabindex="-1">
    <div class="row">
      <div class="version-tag">Version 1 - In development</div>
    </div>

    <div class="row">
      <div class="authors">by Mason Murphy & MASONNET</div>
    </div>

    <div class="row" style="margin-top:6px;">
      <div class="panel-view" aria-hidden="false" id="panelView">
        <svg class="eye" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" width="16" height="16">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" stroke="white" stroke-opacity="0.9" stroke-width="1.2" fill="none"/>
          <circle cx="12" cy="12" r="3" fill="white" />
        </svg>
        <span id="viewsLabel">Views: —</span>
      </div>
    </div>

    <div class="row">
      <a class="contact-link" href="mailto:masonnet@masonnet.org">Contact Us</a>
    </div>
  </div>

  <!-- Button island -->
  <nav class="button-island" role="navigation" aria-label="Primary navigation">
    <button type="button" aria-label="Home"><span>Home</span></button>
    <button type="button" aria-label="Games"><span>Games</span></button>
    <button type="button" aria-label="Projects"><span>Projects</span></button>
    <button type="button" aria-label="More"><span>More</span></button>

    <button type="button" class="info-btn" id="infoBtn" aria-label="Info" aria-expanded="false">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <circle cx="12" cy="12" r="10" fill="none" stroke="white" stroke-opacity="0.95" stroke-width="1.4"/>
        <rect x="11.4" y="10.2" width="1.2" height="5.5" rx="0.6" fill="white"/>
        <rect x="11.4" y="7.2" width="1.2" height="1.2" rx="0.6" fill="white"/>
      </svg>
    </button>
  </nav>

  <script>
    (function(){
      // View counter logic with "recent visit" suppression
      const viewsLabel = document.getElementById('viewsLabel');
      const localVisitKey = 'masonnet_org_lastvisit';
      const storedCountKey = 'masonnet_org_localcount';
      const countNamespace = 'masonnet_org';
      const countKey = 'site_views';
      const hitUrl = `https://api.countapi.xyz/hit/${encodeURIComponent(countNamespace)}/${encodeURIComponent(countKey)}`;
      const getUrl = `https://api.countapi.xyz/get/${encodeURIComponent(countNamespace)}/${encodeURIComponent(countKey)}`;
      const threshold = Number(getComputedStyle(document.documentElement).getPropertyValue('--view-threshold-ms')) || 3600000;

      function setViews(v){
        if (typeof v === 'number') {
          viewsLabel.textContent = 'Views: ' + v.toLocaleString();
        } else {
          viewsLabel.textContent = 'Views: ' + String(v);
        }
      }

      function safeSetLocal(key, value){
        try { localStorage.setItem(key, String(value)); } catch(e){}
      }
      function safeGetLocal(key){
        try { return localStorage.getItem(key); } catch(e){ return null; }
      }

      const lastVisit = parseInt(safeGetLocal(localVisitKey) || '0', 10);
      const now = Date.now();
      const withinThreshold = !isNaN(lastVisit) && (now - lastVisit) < threshold;

      if (withinThreshold) {
        // Don't increment. Try to read current global value.
        fetch(getUrl, {cache: 'no-store'})
          .then(r => r.ok ? r.json() : Promise.reject(r))
          .then(data => {
            if (data && typeof data.value === 'number') {
              setViews(data.value);
              safeSetLocal(storedCountKey, data.value);
            } else {
              const localVal = parseInt(safeGetLocal(storedCountKey) || '0', 10);
              setViews(isNaN(localVal) ? '—' : localVal);
            }
          })
          .catch(()=> {
            const localVal = parseInt(safeGetLocal(storedCountKey) || '0', 10);
            setViews(isNaN(localVal) ? '—' : localVal);
          });
      } else {
        // Attempt to increment the global counter
        fetch(hitUrl, {method: 'GET', cache: 'no-store'})
          .then(r => r.ok ? r.json() : Promise.reject(r))
          .then(data => {
            if (data && typeof data.value === 'number') {
              setViews(data.value);
              safeSetLocal(storedCountKey, data.value);
              safeSetLocal(localVisitKey, now);
            } else {
              throw new Error('invalid response');
            }
          })
          .catch(()=> {
            // On failure, try to get without increment
            fetch(getUrl, {cache: 'no-store'})
              .then(r => r.ok ? r.json() : Promise.reject(r))
              .then(data => {
                if (data && typeof data.value === 'number') {
                  setViews(data.value);
                  safeSetLocal(storedCountKey, data.value);
                  safeSetLocal(localVisitKey, now); // mark local visit
                } else {
                  throw new Error('invalid get');
                }
              })
              .catch(()=> {
                // Final fallback: per-browser local increment
                try {
                  let v = parseInt(safeGetLocal(storedCountKey) || '0', 10);
                  v = isNaN(v) ? 1 : v + 1;
                  safeSetLocal(storedCountKey, v);
                  safeSetLocal(localVisitKey, now);
                  setViews(v);
                } catch(e){
                  setViews('—');
                }
              });
          });
      }

      // Info panel toggle & focus management
      const infoBtn = document.getElementById('infoBtn');
      const infoPanel = document.getElementById('infoPanel');
      let lastFocused = null;
      function togglePanel(force){
        const show = typeof force === 'boolean' ? force : !infoPanel.classList.contains('visible');
        if(show){
          lastFocused = document.activeElement;
          infoPanel.classList.add('visible');
          infoPanel.setAttribute('aria-hidden','false');
          infoBtn.setAttribute('aria-expanded','true');
          try { infoPanel.focus({preventScroll:true}); } catch(e){}
        } else {
          infoPanel.classList.remove('visible');
          infoPanel.setAttribute('aria-hidden','true');
          infoBtn.setAttribute('aria-expanded','false');
          try { if(lastFocused) lastFocused.focus(); } catch(e){}
        }
      }
      infoBtn.addEventListener('click', ()=> togglePanel());
      infoBtn.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); togglePanel(); } });

      document.addEventListener('click', (e)=> {
        if(!infoPanel.classList.contains('visible')) return;
        if(infoPanel.contains(e.target) || infoBtn.contains(e.target)) return;
        togglePanel(false);
      }, {capture:true});
      document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') togglePanel(false); });

      // Keep panel width within viewport on resize
      function adjustInfoPanel(){
        const win = window.innerWidth;
        if(infoPanel.offsetWidth > win - 32) infoPanel.style.width = (win - 32) + 'px';
        else infoPanel.style.width = '';
      }
      window.addEventListener('resize', adjustInfoPanel);
      adjustInfoPanel();
    })();
  </script>
</body>
</html>
