<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MASONNET Web 3.0</title>
  <style>
    :root{
      --bg:#ff0000;
      --glass: rgba(255,255,255,0.10);
      --glass-strong: rgba(255,255,255,0.26);
      --accent:#ffffff;
      --muted: rgba(255,255,255,0.85);
      --shadow: 0 6px 18px rgba(0,0,0,0.15);
      --max-content:1100px;
      --safe-bottom: calc(env(safe-area-inset-bottom, 0px) + 20px);
      --island-max:760px;
      --view-threshold-ms: 3600000; /* 1 hour */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,var(--bg),var(--bg));
      color:var(--accent);
      -webkit-font-smoothing:antialiased;
      line-height:1.35;
      display:flex;
      justify-content:center;
    }

    .page{
      width:100%;
      max-width:var(--max-content);
      padding: clamp(16px, 3.5vw, 36px);
      padding-bottom: calc(var(--safe-bottom) + 150px);
    }

    .site-header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      flex-direction:column;
    }

    .logo{
      width:clamp(160px, 28vw, 420px);
      height:auto;
      display:block;
      border-radius:8px;
      object-fit:contain;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,0.25));
    }

    h1{
      margin:10px 0 0;
      font-size: clamp(20px, 4.2vw, 36px);
      font-weight:700;
      text-align:center;
      background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    h1 u{ text-decoration: underline; text-decoration-thickness:2px; text-decoration-color: rgba(255,255,255,0.35); }

    .meta {
      margin:18px auto 6px;
      text-align:center;
      color:var(--muted);
      font-size: clamp(13px, 2.4vw, 16px);
      display:flex;
      flex-direction:column;
      gap:4px;
      align-items:center;
    }

    .meta .version { font-weight:600; color: rgba(255,255,255,0.96); }
    .meta .authors { opacity:0.95; font-weight:500; }
    .meta .contact a { color:rgba(255,255,255,0.95); text-decoration:underline; }

    .fancy-hr{
      width:100%;
      max-width:900px;
      height:1px;
      margin:12px auto;
      background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.18), rgba(255,255,255,0.06));
      border:none;
      border-radius:1px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }

    .main{
      max-width:980px;
      margin:0 auto;
      text-align:center;
      font-size:clamp(14px, 2.6vw, 18px);
    }

    /* View counter badge */
    .view-counter {
      position: fixed;
      right: clamp(12px, 4vw, 22px);
      bottom: calc(var(--safe-bottom) + 110px);
      z-index:1200;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      color:var(--accent);
      padding:8px 12px;
      border-radius:999px;
      font-weight:600;
      font-size:14px;
      box-shadow: var(--shadow);
      display:flex;
      gap:10px;
      align-items:center;
      backdrop-filter: blur(8px) saturate(1.05);
      min-width:88px;
    }

    .view-counter .eye {
      width:18px;height:18px;display:inline-block;opacity:0.95;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.18));
    }

    .button-island {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: var(--safe-bottom);
      z-index: 1100;
      display:flex;
      gap:12px;
      padding: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      backdrop-filter: blur(10px) saturate(1.05);
      -webkit-backdrop-filter: blur(10px) saturate(1.05);
      border-radius: 999px;
      box-shadow: var(--shadow);
      width: min(calc(100% - 32px), var(--island-max));
      justify-content: space-between;
      align-items:center;
      transition: transform 160ms ease;
    }

    .button-island button{
      all:unset;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: clamp(12px, 2.8vw, 18px) clamp(12px, 3.8vw, 26px);
      background: var(--glass);
      color:var(--accent);
      font-weight:700;
      font-size: clamp(14px, 2.6vw, 18px);
      border-radius:999px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.02);
      transition: transform 140ms ease, background 140ms ease, box-shadow 140ms ease;
      flex:1;
      text-align:center;
      min-width: 64px;
    }

    .button-island button:hover,
    .button-island button:focus{
      transform: translateY(-4px);
      background: var(--glass-strong);
      outline: none;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
    }

    .button-island .info-btn{
      flex:0 0 auto;
      width:48px;
      height:48px;
      padding:0;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }

    .button-island .info-btn svg{width:20px;height:20px;opacity:0.98}

    /* Info panel: constrained so content never overflows */
    .info-panel{
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(16px);
      bottom: calc(var(--safe-bottom) + 80px);
      z-index: 1150;
      width: clamp(280px, 88vw, 520px);
      max-width: 92%;
      max-height: calc(50vh);
      box-sizing: border-box;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      background: linear-gradient(180deg, rgba(30,30,30,0.96), rgba(20,20,20,0.96));
      color:#fff;
      padding:14px;
      border-radius:12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
      display:none;
      gap:8px;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-size:15px;
      word-break:break-word;
      white-space:normal;
    }

    .info-panel.visible{
      display:flex;
      flex-direction:column;
      transform: translateX(-50%) translateY(0);
    }

    .info-panel .row{
      width:100%;
      display:flex;
      justify-content:center;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .info-panel .version-tag{ font-weight:700; background:rgba(255,255,255,0.04); padding:6px 10px; border-radius:999px; }
    .info-panel .authors{ opacity:0.92 }
    .info-panel .contact-link{ display:inline-block; margin-top:6px; color:#fff; text-decoration:underline; font-weight:600; }

    @media (max-width:520px){
      .view-counter{ right:12px; bottom: calc(var(--safe-bottom) + 150px); padding:6px 10px; font-size:13px }
      .button-island{ gap:8px; padding:10px; width: calc(100% - 24px) }
      .button-island .info-btn{ width:44px; height:44px }
      .info-panel{ bottom: calc(var(--safe-bottom) + 72px); width: min(96%,420px) }
    }

    @media (hover:none){
      .button-island button:hover{ transform:none; box-shadow: 0 6px 18px rgba(0,0,0,0.12) }
    }

    /* scrollbar aesthetics for info panel */
    .info-panel::-webkit-scrollbar{ height:8px; width:8px }
    .info-panel::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.06); border-radius:8px }
  </style>
</head>
<body>
  <div class="page" id="page">
    <header class="site-header" role="banner">
      <img src="logo.png" alt="MASONNET logo" class="logo" />
      <h1><strong>Welcome to MASONNET Web <u>3.0</u>!</strong></h1>
    </header>

    <div class="meta" role="contentinfo">
      <div class="version">Version 1 - In development</div>
      <div class="authors">by Mason Murphy & MASONNET</div>
      <div class="contact"> <a href="mailto:masonnet@masonnet.org">Contact Us</a></div>
    </div>

    <hr class="fancy-hr" />

    <main class="main" role="main">
      <!-- Core site content -->
    </main>
  </div>

  <!-- View counter badge -->
  <div class="view-counter" id="viewCounter" aria-hidden="false" title="Public view counter">
    <svg class="eye" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
      <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" stroke="white" stroke-opacity="0.9" stroke-width="1.2" fill="none"/>
      <circle cx="12" cy="12" r="3" fill="white" />
    </svg>
    <span id="viewsLabel">Views: —</span>
  </div>

  <!-- Info panel -->
  <div class="info-panel" id="infoPanel" role="dialog" aria-hidden="true" aria-live="polite" tabindex="-1">
    <div class="row">
      <div class="version-tag">Version 1 - In development</div>
      <div class="authors">by Mason Murphy & MASONNET</div>
    </div>
    <div class="row"><a class="contact-link" href="mailto:masonnet@masonnet.org">Contact Us</a></div>
  </div>

  <!-- Button island -->
  <nav class="button-island" role="navigation" aria-label="Primary navigation">
    <button type="button" aria-label="Home"><span>Home</span></button>
    <button type="button" aria-label="Games"><span>Games</span></button>
    <button type="button" aria-label="Projects"><span>Projects</span></button>
    <button type="button" aria-label="More"><span>More</span></button>

    <button type="button" class="info-btn" id="infoBtn" aria-label="Info" aria-expanded="false">
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <circle cx="12" cy="12" r="10" fill="none" stroke="white" stroke-opacity="0.95" stroke-width="1.4"/>
        <rect x="11.4" y="10.2" width="1.2" height="5.5" rx="0.6" fill="white"/>
        <rect x="11.4" y="7.2" width="1.2" height="1.2" rx="0.6" fill="white"/>
      </svg>
    </button>
  </nav>

  <script>
    (function(){
      // Config
      const viewsLabel = document.getElementById('viewsLabel');
      const localKey = 'masonnet_org_lastvisit';
      const countNamespace = 'masonnet_org';
      const countKey = 'site_views';
      const hitUrl = `https://api.countapi.xyz/hit/${encodeURIComponent(countNamespace)}/${encodeURIComponent(countKey)}`;
      const getUrl = `https://api.countapi.xyz/get/${encodeURIComponent(countNamespace)}/${encodeURIComponent(countKey)}`;
      const threshold = Number(getComputedStyle(document.documentElement).getPropertyValue('--view-threshold-ms')) || 3600000;

      function setViews(v){
        if (typeof v === 'number') {
          viewsLabel.textContent = 'Views: ' + v.toLocaleString();
        } else {
          viewsLabel.textContent = 'Views: ' + String(v);
        }
      }

      function safeSetLocal(key, value){
        try { localStorage.setItem(key, String(value)); } catch(e){}
      }
      function safeGetLocal(key){
        try { return localStorage.getItem(key); } catch(e){ return null; }
      }

      // Determine whether to increment: if last visit within threshold, do not increment.
      const lastVisit = parseInt(safeGetLocal(localKey) || '0', 10);
      const now = Date.now();
      const withinThreshold = !isNaN(lastVisit) && (now - lastVisit) < threshold;

      if (withinThreshold) {
        // Don't increment — just fetch current value
        fetch(getUrl, {cache: 'no-store'}).then(r => r.ok ? r.json() : Promise.reject(r))
          .then(data => {
            if (data && typeof data.value === 'number') setViews(data.value);
            else setViews('—');
          })
          .catch(()=> {
            // fallback to stored local counter if available
            const localVal = parseInt(safeGetLocal(countKey) || '0',10);
            setViews(isNaN(localVal) ? '—' : localVal);
          });
      } else {
        // Attempt to increment the global counter
        fetch(hitUrl, {method: 'GET', cache: 'no-store'})
          .then(r => r.ok ? r.json() : Promise.reject(r))
          .then(data => {
            if (data && typeof data.value === 'number') {
              setViews(data.value);
              safeSetLocal(countKey, data.value);
              safeSetLocal(localKey, now);
            } else {
              throw new Error('invalid response');
            }
          })
          .catch(()=> {
            // On failure, attempt to read current value (without increment)
            fetch(getUrl, {cache: 'no-store'})
              .then(r => r.ok ? r.json() : Promise.reject(r))
              .then(data => {
                if (data && typeof data.value === 'number') {
                  setViews(data.value);
                  safeSetLocal(countKey, data.value);
                  safeSetLocal(localKey, now); // still mark local visit so we won't spam later
                } else {
                  throw new Error('invalid get');
                }
              })
              .catch(()=> {
                // final fallback: local per-browser increment (best-effort)
                try {
                  let v = parseInt(safeGetLocal(countKey)||'0',10);
                  v = isNaN(v) ? 1 : v + 1;
                  safeSetLocal(countKey, v);
                  safeSetLocal(localKey, now);
                  setViews(v);
                } catch(e){
                  setViews('—');
                }
              });
          });
      }

      // Info panel toggle & focus management
      const infoBtn = document.getElementById('infoBtn');
      const infoPanel = document.getElementById('infoPanel');
      let lastFocused = null;
      function togglePanel(force){
        const show = typeof force === 'boolean' ? force : !infoPanel.classList.contains('visible');
        if(show){
          lastFocused = document.activeElement;
          infoPanel.classList.add('visible');
          infoPanel.setAttribute('aria-hidden','false');
          infoBtn.setAttribute('aria-expanded','true');
          try { infoPanel.focus({preventScroll:true}); } catch(e){}
        } else {
          infoPanel.classList.remove('visible');
          infoPanel.setAttribute('aria-hidden','true');
          infoBtn.setAttribute('aria-expanded','false');
          try { if(lastFocused) lastFocused.focus(); } catch(e){}
        }
      }
      infoBtn.addEventListener('click', ()=> togglePanel());
      infoBtn.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); togglePanel(); } });

      document.addEventListener('click', (e)=> {
        if(!infoPanel.classList.contains('visible')) return;
        if(infoPanel.contains(e.target) || infoBtn.contains(e.target)) return;
        togglePanel(false);
      }, {capture:true});
      document.addEventListener('keydown', (e)=> { if(e.key === 'Escape') togglePanel(false); });

      // Responsive adjustment to ensure info panel width never exceeds viewport
      function adjustInfoPanel(){
        const win = window.innerWidth;
        if(infoPanel.offsetWidth > win - 40) infoPanel.style.width = (win - 40) + 'px';
        else infoPanel.style.width = '';
      }
      window.addEventListener('resize', adjustInfoPanel);
      adjustInfoPanel();

    })();
  </script>
</body>
</html>
